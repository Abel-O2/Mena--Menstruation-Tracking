<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Calendar</title>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
         body {
            background-color:#6200E8;
            color: black;
            font-family: Arial, sans-serif;
        }
        
        #calendar {
            background-color: #f4f4f4; /* light gray */
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .fc-event {
            background-color: #add8e6; /* light blue for events */
            color: black;
        }

        .fc-daygrid-day:hover {
            background-color: #dcdcdc; /* light gray hover */
            cursor: pointer;
        }

        h2 a {
            text-decoration: none;
            color: black;
            transition: color 0.3s ease;
        }

        h2 a:hover {
            color: blueviolet;
            text-decoration: none;
        }

    </style>
</head>
<body>
    
    <h2> 
    <a href="{% url 'home' %}">Home</a>
    </h2>
    
    <div id="calendar"></div>

    <script>
        function getCSRFToken() {
            return document.querySelector('[name=csrfmiddlewaretoken]').value;
        }
        document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        events: '/MenaApp/calendar/',
        editable: true,
        selectable: true,
        select: function(info) {
            var title = prompt("Start of period:");
            if (title) {
                $.ajaxSetup({
                    url: '/MenaApp/calendar/',
                    type: 'POST',
                    data: JSON.stringify({
                        title: title,
                        start: info.startStr,
                        end: info.endStr,
                        is_pinned: false  
                    }),
                    contentType: 'application/json',
                    success: function(data) {
                        // Save the event ID for later updates
                        info.event.id = data.id;
                        calendar.refetchEvents();
                    },
                    beforeSend: function(xhr, settings) {
                        if (!this.crossDomain) {
                            xhr.setRequestHeader("X-CSRFToken", getCSRFToken());
                        }
                     }
                });
            }
            calendar.unselect();
        },
        eventClick: function(info) {
            var isPinned = confirm("Do you want to pin this day?");
            info.event.setExtendedProp('is_pinned', isPinned);
            $.ajax({
                url: '/MenaApp/calendar/',
                type: 'PATCH',
                data: JSON.stringify({
                    id: info.event.id,
                    is_pinned: isPinned
                }),
                contentType: 'application/json',
                success: function() {
                    calendar.refetchEvents();
                }
            });
        },
        eventRender: function(info) {
            console.log(info.event.title);
        }
    });
    calendar.render();
});

    </script>
</body>
</html>
